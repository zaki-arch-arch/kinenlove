<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<title>ãƒˆã‚­ãƒ¡ã‚­ç¦ç…™ãƒ¡ãƒ¢ãƒªã‚¢ãƒ« v9.0</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    /* åŸºæœ¬è¨­å®š */
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { 
        margin: 0; padding: 0; 
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
        background-color: #fff1f2; color: #334155; 
        overscroll-behavior-y: none;
        user-select: none;
        min-height: 100vh;
        width: 100%;
        overflow-x: hidden;
    }
    
    /* ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ */
    .hidden { display: none !important; }
    .container { width: 100%; min-height: 100vh; padding-bottom: 120px; display: flex; flex-direction: column; align-items: center; }
    
    /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }
    .animate-breathe { animation: breathe 6s ease-in-out infinite; }
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-6px); } }
    .animate-float { animation: float 5s ease-in-out infinite; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
    @keyframes pulse-slow { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .animate-pulse-slow { animation: pulse-slow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }

    /* ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¹ã‚¿ã‚¤ãƒ« (Tailwindã§è£œãˆãªã„ç´°ã‹ã„èª¿æ•´) */
    .heroine-img { object-fit: cover; width: 100%; height: 100%; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚¨ãƒªã‚¢ */
    #debug-console {
        display: none; /* é€šå¸¸ã¯éè¡¨ç¤º */
        position: fixed; bottom: 0; left: 0; width: 100%; max-height: 100px;
        background: rgba(0,0,0,0.8); color: lime; font-size: 10px; font-family: monospace;
        overflow-y: auto; z-index: 99999; padding: 5px; pointer-events: none;
    }
</style>
<script>
    // ç°¡æ˜“ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚¬ãƒ¼
    function log(msg) {
        console.log(msg);
        var el = document.getElementById('debug-console');
        if(el) {
            var p = document.createElement('div');
            p.innerText = '> ' + msg;
            el.appendChild(p);
            el.scrollTop = el.scrollHeight;
        }
    }
    window.onerror = function(msg, url, line) {
        log('ERROR: ' + msg + ' (L:' + line + ')');
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + msg); // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥
        return false;
    };
</script>
</head>
<body>

    <!-- ãƒ‡ãƒãƒƒã‚°ç”¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ« -->
    <div id="debug-console"></div>

    <!-- 1. ãƒ­ãƒ¼ãƒ‰ç”»é¢ -->
    <div id="view-loading" class="fixed inset-0 bg-rose-50 flex flex-col items-center justify-center z-[9999]">
        <div class="text-6xl mb-4 animate-bounce">ğŸ’—</div>
        <div class="font-bold text-rose-400 mb-8">Loading...</div>
        <button onclick="window.fullReset()" class="px-6 py-3 bg-white border border-slate-300 rounded-full text-xs text-slate-500 shadow-sm active:bg-slate-100">
            èµ·å‹•ã—ãªã„å ´åˆã¯ã“ã“ã‚’ã‚¿ãƒƒãƒ—<br>(å¼·åˆ¶ãƒªã‚»ãƒƒãƒˆ)
        </button>
    </div>

    <!-- 2. ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”»é¢ -->
    <div id="view-setup" class="hidden min-h-screen flex items-center justify-center p-6">
        <div class="bg-white p-8 rounded-[2rem] shadow-xl w-full max-w-sm space-y-5 animate-fade-in border-b-4 border-rose-100">
            <h1 class="text-xl font-black text-rose-500 text-center flex items-center justify-center gap-2">
                <span>ğŸ’–</span> ç¦ç…™ãƒ¡ãƒ¢ãƒªã‚¢ãƒ«
            </h1>
            <div>
                <label class="text-xs font-bold text-slate-400 ml-1">1æ—¥ã®æœ¬æ•°</label>
                <input id="inp-c" type="number" value="20" class="w-full p-3 bg-rose-50 rounded-xl font-bold text-slate-700 outline-none focus:ring-2 focus:ring-rose-200 border border-slate-100">
            </div>
            <div>
                <label class="text-xs font-bold text-slate-400 ml-1">1ç®±ã®å€¤æ®µ</label>
                <input id="inp-p" type="number" value="600" class="w-full p-3 bg-rose-50 rounded-xl font-bold text-slate-700 outline-none focus:ring-2 focus:ring-rose-200 border border-slate-100">
            </div>
            <div class="pt-2 border-t border-rose-100">
                <p class="text-xs font-bold text-rose-400 mb-2">âœ¨ ç›®æ¨™ï¼ˆæ¬²ã—ã„ã‚‚ã®ï¼‰</p>
                <input id="inp-gn" type="text" placeholder="ä¾‹: ç„¼è‚‰" class="w-full p-3 bg-rose-50 rounded-xl font-bold text-slate-700 outline-none focus:ring-2 focus:ring-rose-200 mb-2 border border-slate-100">
                <input id="inp-gc" type="number" placeholder="é‡‘é¡ (å††)" class="w-full p-3 bg-rose-50 rounded-xl font-bold text-slate-700 outline-none focus:ring-2 focus:ring-rose-200 border border-slate-100">
            </div>
            <button onclick="app.nextSetup()" class="w-full bg-rose-500 text-white py-4 rounded-full font-bold shadow-lg shadow-rose-200 active:scale-95 transition mt-2">
                æ¬¡ã¸
            </button>
        </div>
    </div>

    <!-- 3. ã‚­ãƒ£ãƒ©ç™»éŒ²ç”»é¢ -->
    <div id="view-char" class="hidden min-h-screen flex flex-col items-center justify-center p-6 text-center">
        <h2 class="text-xl font-bold text-slate-700 mb-6">ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚’é¸ã‚“ã§ã­</h2>
        
        <div class="flex bg-white rounded-full p-1.5 shadow-sm mb-6 w-full max-w-xs border border-rose-100">
            <button onclick="app.setRegMode('normal')" id="btn-mode-normal" class="flex-1 py-2 text-xs font-bold rounded-full transition bg-rose-500 text-white">é€šå¸¸</button>
            <button onclick="app.setRegMode('happy')" id="btn-mode-happy" class="flex-1 py-2 text-xs font-bold rounded-full transition text-slate-400">ç¬‘é¡”</button>
            <button onclick="app.setRegMode('sad')" id="btn-mode-sad" class="flex-1 py-2 text-xs font-bold rounded-full transition text-slate-400">æ‚²ã—ã¿</button>
        </div>

        <div id="preview-area" class="relative w-64 h-64 bg-white border-4 border-dashed border-rose-200 rounded-[2.5rem] flex items-center justify-center overflow-hidden shadow-sm mb-8 transition-colors">
            <!-- ç”»åƒãŒãªã„æ™‚ã®è¡¨ç¤º -->
            <div id="preview-placeholder" class="text-center p-4 text-rose-300">
                <div class="text-4xl mb-2">ğŸ“·</div>
                <span class="text-xs font-bold">ç”»åƒã‚’ã‚¿ãƒƒãƒ—ã—ã¦é¸æŠ</span>
            </div>
            <!-- ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
            <img id="preview-img" class="absolute inset-0 w-full h-full object-cover hidden">
            <!-- ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ› -->
            <input type="file" accept="image/*" onchange="app.handleFile(this)" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
        </div>

        <p class="text-xs text-slate-400 mb-4">â€»ç¬‘é¡”ãƒ»æ‚²ã—ã¿ã¯æœªè¨­å®šã§ã‚‚OKã§ã™</p>

        <button onclick="app.startMain()" class="w-full max-w-xs bg-rose-500 text-white py-4 rounded-full font-bold shadow-lg shadow-rose-200 active:scale-95 transition">
            ç¦ç…™ç”Ÿæ´»ã‚’å§‹ã‚ã‚‹
        </button>
    </div>

    <!-- 4. ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
    <div id="view-main" class="hidden w-full min-h-screen">
        <!-- èƒŒæ™¯è£…é£¾ -->
        <div class="fixed top-0 left-0 w-full h-80 bg-rose-100 rounded-b-[60px] -z-10"></div>

        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="flex justify-between items-center p-6 pt-10 sticky top-0 z-40 bg-rose-100/80 backdrop-blur-sm rounded-b-2xl">
            <div class="flex items-center gap-2 text-rose-500 font-bold bg-white/90 px-4 py-1.5 rounded-full shadow-sm border border-white">
                <span>â¤ï¸</span> <span id="disp-lv">Lv.1</span>
            </div>
            <button onclick="window.fullReset()" class="bg-white/90 text-slate-400 text-xs font-bold px-3 py-2 rounded-full shadow-sm border border-white active:scale-95 transition flex items-center gap-1">
                ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
            </button>
        </div>

        <!-- ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚¨ãƒªã‚¢ -->
        <div class="flex flex-col items-center mt-4 z-10">
            <div onclick="app.tapHeroine()" class="w-72 h-72 rounded-full border-[8px] border-white shadow-xl overflow-hidden bg-slate-100 animate-breathe relative cursor-pointer active:scale-95 transition-transform">
                <img id="main-heroine-img" class="heroine-img">
            </div>
            
            <div class="relative mt-[-25px] z-20 w-[85%] max-w-sm">
                <div class="bg-white/95 backdrop-blur-sm p-5 rounded-2xl shadow-lg border border-rose-100 text-center animate-float">
                    <p id="main-dialogue" class="text-sm font-bold text-slate-700 leading-relaxed">ä»Šæ—¥ã‚‚æˆ‘æ…¢ã§ãã¦å‰ã„ï¼</p>
                    <div class="absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white rotate-45 border-t border-l border-rose-100"></div>
                </div>
            </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¨ãƒªã‚¢ -->
        <div class="mt-8 px-6 grid grid-cols-2 gap-4">
            <!-- ç¦ç…™æ™‚é–“ -->
            <div class="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-50 flex flex-col items-center justify-center h-36">
                <div class="text-slate-300 mb-1 text-xl">â°</div>
                <div class="text-[10px] text-slate-400 font-bold mb-1">ç¦ç…™æ™‚é–“</div>
                <div class="text-center font-black text-slate-700 leading-tight">
                    <div><span id="timer-d" class="text-xl">0</span><span class="text-xs">æ—¥</span> <span id="timer-h" class="text-xl">0</span><span class="text-xs">æ™‚é–“</span></div>
                    <div class="mt-1"><span id="timer-m" class="text-lg">0</span><span class="text-xs">åˆ†</span> <span id="timer-s" class="text-lg text-rose-500 font-mono">00</span><span class="text-xs">ç§’</span></div>
                </div>
            </div>
            <!-- ç´¯è¨ˆç¯€ç´„ -->
            <div class="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-50 flex flex-col items-center justify-between h-36">
                <div class="flex flex-col items-center w-full">
                    <div class="text-rose-300 mb-1 text-xl">ğŸ–</div>
                    <div class="text-[10px] text-slate-400 font-bold mb-1">ç´¯è¨ˆç¯€ç´„</div>
                    <div id="val-total" class="text-2xl font-black text-rose-500">Â¥0</div>
                </div>
                
                <!-- ç›®æ¨™ãƒãƒ¼ -->
                <div id="goal-area" class="w-full hidden">
                    <div class="flex justify-between text-[10px] text-slate-500 mb-1 font-bold">
                        <span id="goal-name" class="truncate max-w-[60px]">ç›®æ¨™</span>
                        <span id="goal-percent">0%</span>
                    </div>
                    <div class="w-full h-1.5 bg-slate-100 rounded-full overflow-hidden">
                        <div id="goal-bar" class="h-full bg-rose-400 transition-all duration-1000" style="width:0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SOSãƒœã‚¿ãƒ³ -->
        <div class="mt-6 px-6">
            <button onclick="app.openSos()" class="w-full bg-slate-800 text-white py-4 rounded-2xl font-bold shadow-xl shadow-slate-300 flex items-center justify-center gap-2 active:scale-95 transition overflow-hidden relative">
                <div class="absolute inset-0 bg-white/10 animate-pulse-slow"></div>
                <span>âš ï¸</span> <span class="text-lg">å¸ã„ãŸããªã£ãŸã‚‰æŠ¼ã—ã¦</span>
            </button>
        </div>

        <!-- æ¨ã—æ´»ã‚·ãƒ§ãƒƒãƒ— -->
        <div class="mt-10 px-6">
            <div class="flex justify-between items-end mb-4">
                <h3 class="font-bold text-slate-700 flex items-center gap-2 text-sm">
                    <span>ğŸ</span> æ¨ã—æ´»ã‚·ãƒ§ãƒƒãƒ—
                </h3>
                <div class="text-[10px] font-bold text-slate-400 bg-white px-3 py-1.5 rounded-full border border-slate-100 shadow-sm">
                    æ®‹é«˜: <span id="val-wallet" class="text-rose-500 text-base ml-1">Â¥0</span>
                </div>
            </div>
            
            <div id="gift-list" class="flex gap-3 overflow-x-auto no-scrollbar pb-4 -mx-6 px-6">
                <!-- ã‚®ãƒ•ãƒˆã¯JSã§ç”Ÿæˆ -->
            </div>
        </div>

        <!-- ãƒ•ãƒƒã‚¿ãƒ¼ (å¥½æ„Ÿåº¦) -->
        <div class="fixed bottom-0 left-0 w-full bg-white/95 backdrop-blur-md border-t border-slate-100 p-4 pb-8 safe-area-pb z-30 shadow-[0_-5px_20px_rgba(0,0,0,0.02)]">
            <div class="flex justify-between text-[10px] font-bold text-slate-400 mb-2">
                <span>LOVE POINT</span>
                <span id="love-text">0 / 100</span>
            </div>
            <div class="w-full h-3 bg-slate-100 rounded-full overflow-hidden">
                <div id="love-bar" class="h-full bg-gradient-to-r from-rose-300 to-rose-500 transition-all duration-1000" style="width:0%"></div>
            </div>
        </div>

        <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: SOS -->
        <div id="modal-sos" class="hidden fixed inset-0 bg-slate-900 z-[100] flex flex-col items-center justify-center text-white p-6">
            <button onclick="app.closeSos()" class="absolute top-6 right-6 p-2 bg-white/10 rounded-full z-50">âœ•</button>
            <h2 class="text-3xl font-black text-rose-400 mb-8 animate-pulse tracking-widest mt-10">EMERGENCY</h2>
            <div class="relative w-64 h-64 mb-8">
                <div class="w-full h-full rounded-full border-4 border-rose-500/50 shadow-[0_0_50px_rgba(244,63,94,0.3)] overflow-hidden bg-slate-800 relative z-10 animate-breathe">
                    <img id="sos-img" class="w-full h-full object-cover filter grayscale-[30%] brightness-75">
                </div>
            </div>
            <div class="w-full max-w-sm text-center space-y-6 relative z-10">
                <div class="bg-white/10 backdrop-blur-md p-6 rounded-2xl border border-white/10">
                    <p id="sos-msg" class="text-lg font-bold leading-relaxed">ã€Œãƒ€ãƒ¡ï¼å¸ã£ãŸã‚‰æ‚²ã—ã„ã‚ˆï¼Ÿã€</p>
                </div>
                <div class="flex gap-4 justify-center mt-4">
                    <button onclick="app.closeSos()" class="bg-rose-500 hover:bg-rose-600 text-white px-8 py-3 rounded-full font-bold shadow-lg active:scale-95 transition">æˆ‘æ…¢ã™ã‚‹</button>
                    <button onclick="app.execPenalty()" class="bg-transparent border border-white/20 text-white/40 px-4 py-3 rounded-full text-xs active:bg-white/10">å¸ã†(ãƒšãƒŠãƒ«ãƒ†ã‚£)</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ã€ç·Šæ€¥ã€‘ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ (ç‹¬ç«‹) -->
    <script>
        window.fullReset = function() {
            if(confirm('ã€ä¿®å¾©ã€‘ãƒ‡ãƒ¼ã‚¿ã‚’å…¨ã¦å‰Šé™¤ã—ã¦åˆæœŸåŒ–ã—ã¾ã™ã‹ï¼Ÿ')) {
                try {
                    localStorage.clear();
                    alert('å‰Šé™¤ã—ã¾ã—ãŸã€‚ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚');
                    location.reload();
                } catch(e) {
                    alert('å‰Šé™¤å¤±æ•—: ' + e);
                }
            }
        };
    </script>

    <script>
    // --- ã‚¢ãƒ—ãƒªã®ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ (Vanilla JS) ---
    (function() {
        var APP_KEY = 'tokikin_v9_0';
        
        // ãƒ¡ãƒ¢ãƒªä¿å­˜ç”¨ (localStorageãŒä½¿ãˆãªã„å ´åˆç”¨)
        var memStorage = {};

        var DATA = {
            profile: null,
            heroines: [],
            regMode: 'normal',
            previewImages: { normal: null, happy: null, sad: null }
        };

        var GIFTS = [
            { id: 1, name: 'ã‚¹ã‚¤ãƒ¼ãƒ„', cost: 500, icon: 'ğŸ°', love: 15 },
            { id: 2, name: 'ã‚³ã‚¹ãƒ¡', cost: 3000, icon: 'ğŸ’„', love: 80 },
            { id: 3, name: 'æ¸©æ³‰æ—…è¡Œ', cost: 15000, icon: 'â™¨ï¸', love: 450 },
            { id: 4, name: 'æŒ‡è¼ª', cost: 100000, icon: 'ğŸ’', love: 2500 }
        ];

        var SCENARIOS = [
            "ä»Šæ—¥ã‚‚æˆ‘æ…¢ã§ãã¦å‰ã„ï¼", "ã‚¿ãƒã‚³ã‚ˆã‚Šç§ã‚’è¦‹ã¦ï¼Ÿ", "æµ®ã„ãŸãŠé‡‘ã§ãƒ‡ãƒ¼ãƒˆã—ã‚ˆï¼Ÿ",
            "ã‚ãªãŸãŒå¥åº·ã ã¨ç§ã‚‚å¬‰ã—ã„ã€‚", "ãšã£ã¨ä¸€ç·’ã«ã„ã‚ˆã†ã­ã€‚", "ã­ãˆã€ã‚­ã‚¹ã—ã¦ã‚‚ã„ã„ï¼Ÿ"
        ];

        var SOS_MSGS = [
            "ãƒ€ãƒ¡ï¼ã“ã“ã§å¸ã£ãŸã‚‰å°ç„¡ã—ã ã‚ˆï¼Ÿ", "ç§ã®ãŸã‚ã«æˆ‘æ…¢ã—ã¦â€¦ãŠé¡˜ã„ã€‚",
            "æ·±å‘¼å¸ã—ã¦ã€‚ç§ãŒã¤ã„ã¦ã‚‹ã‹ã‚‰ã€‚", "ãã®1æœ¬ã€æœ¬å½“ã«å¿…è¦ï¼Ÿ"
        ];

        // --- Helper ---
        function get(id) { return document.getElementById(id); }
        function show(id) { get(id).classList.remove('hidden'); }
        function hide(id) { get(id).classList.add('hidden'); }
        function setText(id, txt) { var el = get(id); if(el) el.innerText = txt; }
        
        // --- Storage (Safety First) ---
        function save() {
            try {
                localStorage.setItem(APP_KEY + '_profile', JSON.stringify(DATA.profile));
                localStorage.setItem(APP_KEY + '_heroines', JSON.stringify(DATA.heroines));
                return true;
            } catch(e) { 
                log('Storage Access Error: ' + e.message);
                // ã‚¨ãƒ©ãƒ¼ã§ã‚‚ãƒ¡ãƒ¢ãƒªã«ã¯æ®‹ã£ã¦ã„ã‚‹ã®ã§trueã‚’è¿”ã™ï¼ˆé€²ã‚ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼‰
                return true; 
            }
        }

        function load() {
            try {
                var p = localStorage.getItem(APP_KEY + '_profile');
                var h = localStorage.getItem(APP_KEY + '_heroines');
                if (p && h) {
                    DATA.profile = JSON.parse(p);
                    DATA.heroines = JSON.parse(h);
                    return true;
                }
            } catch(e) {
                log('Load Error: ' + e.message);
            }
            return false;
        }

        // --- Image ---
        function resizeImage(file, callback) {
            var reader = new FileReader();
            reader.onload = function(e) {
                var img = new Image();
                img.onload = function() {
                    var canvas = document.createElement('canvas');
                    var max = 500;
                    var w = img.width; var h = img.height;
                    if (w > h) { if (w > max) { h *= max/w; w = max; } } else { if (h > max) { w *= max/h; h = max; } }
                    canvas.width = w; canvas.height = h;
                    var ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, w, h);
                    callback(canvas.toDataURL('image/jpeg', 0.7));
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // --- App Object ---
        window.app = {
            init: function() {
                log('App initializing...');
                if (load() && DATA.profile.startQuitDate) {
                    this.switchView('main');
                    this.initMain();
                } else {
                    DATA.profile = { dailyTarget: 20, pricePerPack: 600, money: 0, love: 0, goalName: '', goalCost: 0, giftHistory: {} };
                    this.switchView('setup');
                }
                hide('view-loading');
            },

            switchView: function(viewName) {
                hide('view-loading');
                hide('view-setup');
                hide('view-char');
                hide('view-main');
                show('view-' + viewName);
            },

            // Setup
            nextSetup: function() {
                DATA.profile.dailyTarget = parseInt(get('inp-c').value);
                DATA.profile.pricePerPack = parseInt(get('inp-p').value);
                DATA.profile.goalName = get('inp-gn').value;
                DATA.profile.goalCost = parseInt(get('inp-gc').value) || 0;
                this.switchView('char');
            },

            // Char Reg
            setRegMode: function(mode) {
                DATA.regMode = mode;
                ['normal', 'happy', 'sad'].forEach(function(m){
                    var btn = get('btn-mode-'+m);
                    if (mode === m) {
                        btn.className = "flex-1 py-2 text-xs font-bold rounded-full transition bg-rose-500 text-white";
                        get('preview-area').style.borderColor = (m==='normal'?'#fecdd3':(m==='happy'?'#fde047':'#93c5fd'));
                    } else {
                        btn.className = "flex-1 py-2 text-xs font-bold rounded-full transition text-slate-400";
                    }
                });
                
                var img = DATA.previewImages[mode];
                var imgEl = get('preview-img');
                if (img) {
                    imgEl.src = img;
                    show('preview-img');
               
